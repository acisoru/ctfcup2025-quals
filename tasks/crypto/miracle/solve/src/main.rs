use std::collections::HashMap;

fn main() {
    let coeffs = vec![
        46581040046047902834u128,
        48108936923188371195u128,
        29172319943722777758u128,
        20469682910537291931u128,
        53895309652525586033u128,
        63882968039504819686u128,
        70494786946909688144u128,
        8095979132496026646u128,
        49052244532030181419u128,
        52593493737403910870u128,
        52472656894828988475u128,
        17587863416314289685u128,
        57803756171363676598u128,
        28047146460820905948u128,
        49756363861171044771u128,
        19358612602320783574u128,
        47523904519074048033u128,
        35155292266170091913u128,
        64380209506972013378u128,
        17196744302078353084u128,
        8328983555338362661u128,
        23758983100729188272u128,
        31660569019619853527u128,
        18700697966758079667u128,
        54556902404632103609u128,
        15368127252803332010u128,
        70011640035062267210u128,
        46760603732735887116u128,
        70358155767040951571u128,
        17519951341365858966u128,
        63242774152355886460u128,
        18383498364252555936u128,
        43537628885401686083u128,
        53654800082746308197u128,
        40696749359264458848u128,
        40489620066640004509u128,
        51580578637648337579u128,
        27869095479229165483u128,
        5212524921931743540u128,
        20097135351147582137u128,
        67989588136816736125u128,
        53636396610159920443u128,
        59445665025618014323u128,
        68085578304199973299u128,
        56297127198888108551u128,
        26789849962896208607u128,
        2366394143653765190u128,
        42710064527485712312u128,
        43523375885637768509u128,
        68898370782714849815u128,
        55173876191446679902u128,
        63588945889605907396u128,
        54329431175782808468u128,
        37541214133839838956u128,
        41992354412778502682u128,
        64996070705467914398u128,
    ];
    let target = 1351024592240801767957u128;
    let n = coeffs.len();

    let mut solutions_lower: HashMap<u128, u32> = HashMap::with_capacity(268435456);

    for i in 0..(1u64 << (n / 2)) {
        let mut sum = 0u128;
        for j in 0..(n / 2) {
            if (i >> j) & 1 == 1 {
                sum = sum.wrapping_add(coeffs[j]);
            }
        }
        if sum > target {
            continue;
        }
        solutions_lower.insert(sum, i as u32);
    }

    for i in 0..(1u64 << (n / 2)) {
        let mut sum = 0u128;
        for j in 0..(n / 2) {
            if (i >> j) & 1 == 1 {
                sum = sum.wrapping_add(coeffs[j + (n / 2)]);
            }
        }
        if sum > target {
            continue;
        }
        let complement = target.wrapping_sub(sum);
        if solutions_lower.contains_key(&complement) {
            let lower_bits = solutions_lower[&complement];
            let solution = (i << (n / 2)) | (lower_bits as u64);
            println!("Solution found: {}", solution);
            return;
        }
    }
}
